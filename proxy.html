<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Proxy - –ó–∞–≥—Ä—É–∑–∫–∞...</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #121826;
            color: white;
            min-height: 100vh;
        }
        
        .header {
            background: #1f2937;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #374151;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .url-display {
            background: #374151;
            padding: 12px 20px;
            border-radius: 12px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            flex-grow: 1;
            margin: 0 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .control-btn {
            background: #4b5563;
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .control-btn:hover {
            background: #6b7280;
        }
        
        .main-content {
            display: flex;
            height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: 300px;
            background: #1f2937;
            border-right: 1px solid #374151;
            padding: 20px;
            overflow-y: auto;
            display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }
        
        .proxy-frame {
            flex-grow: 1;
            border: none;
            background: white;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #121826;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #374151;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .proxy-selector {
            background: #374151;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .proxy-selector select {
            width: 100%;
            padding: 10px;
            background: #4b5563;
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .stats {
            background: #374151;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
            
            .url-display {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="header-controls">
            <button class="control-btn" onclick="goBack()" title="–ù–∞–∑–∞–¥">
                ‚Üê
            </button>
            <button class="control-btn" onclick="reload()" title="–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å">
                ‚Üª
            </button>
            <button class="control-btn" onclick="goForward()" title="–í–ø–µ—Ä–µ–¥">
                ‚Üí
            </button>
        </div>
        
        <div class="url-display" id="currentUrl">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        
        <div class="header-controls">
            <button class="control-btn" onclick="openSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                ‚öôÔ∏è
            </button>
            <button class="control-btn" onclick="goHome()" title="–î–æ–º–æ–π">
                üè†
            </button>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar" id="sidebar">
            <div class="proxy-selector">
                <strong>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∫—Å–∏:</strong>
                <select id="proxySelect">
                    <option value="cors-anywhere">CORS Anywhere (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π)</option>
                    <option value="allorigins">AllOrigins (–±—ã—Å—Ç—Ä—ã–π)</option>
                    <option value="corsproxy">CORS Proxy.io</option>
                    <option value="thingproxy">ThingProxy</option>
                </select>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <span>–°—Ç–∞—Ç—É—Å:</span>
                    <span id="status" style="color: #2ecc71;">‚óè –û–Ω–ª–∞–π–Ω</span>
                </div>
                <div class="stat-item">
                    <span>–ó–∞–¥–µ—Ä–∂–∫–∞:</span>
                    <span id="latency">-</span>
                </div>
                <div class="stat-item">
                    <span>–†–∞–∑–º–µ—Ä:</span>
                    <span id="size">-</span>
                </div>
                <div class="stat-item">
                    <span>–í—Ä–µ–º—è:</span>
                    <span id="loadTime">-</span>
                </div>
            </div>
        </div>
        
        <!-- Iframe –¥–ª—è —Å–∞–π—Ç–∞ -->
        <iframe class="proxy-frame" id="proxyFrame" sandbox="allow-same-origin allow-forms allow-scripts"></iframe>
    </div>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- JavaScript -->
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const PROXY_SERVERS = {
            'cors-anywhere': 'https://cors-anywhere.herokuapp.com/',
            'allorigins': 'https://api.allorigins.win/raw?url=',
            'corsproxy': 'https://corsproxy.io/?',
            'thingproxy': 'https://thingproxy.freeboard.io/fetch/'
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentProxy = 'cors-anywhere';
        let currentUrl = '';
        let history = [];
        let historyIndex = -1;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–ª—É—á–∞–µ–º URL –∏–∑ localStorage –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const url = getUrlFromParams() || localStorage.getItem('proxy_url') || 'https://wikipedia.org';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Å–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const savedProxy = localStorage.getItem('proxy_server') || 'cors-anywhere';
            document.getElementById('proxySelect').value = savedProxy;
            currentProxy = savedProxy;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∞–π—Ç
            loadSite(url);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ URL
            document.getElementById('currentUrl').textContent = url;
            currentUrl = url;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory(url);
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤—ã–±–æ—Ä–µ –ø—Ä–æ–∫—Å–∏
            document.getElementById('proxySelect').addEventListener('change', function(e) {
                currentProxy = e.target.value;
                localStorage.setItem('proxy_server', currentProxy);
                reload();
            });
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç iframe
            window.addEventListener('message', handleIframeMessage);
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∞–π—Ç–∞
        async function loadSite(url) {
            const loading = document.getElementById('loading');
            const frame = document.getElementById('proxyFrame');
            const startTime = Date.now();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.style.display = 'flex';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
                if (!isValidUrl(url)) {
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL');
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–∫—Å–∏ URL
                const proxyUrl = PROXY_SERVERS[currentProxy] + encodeURIComponent(url);
                
                // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
                const response = await fetch(proxyUrl, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º HTML
                const html = await response.text();
                const loadTime = Date.now() - startTime;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º HTML
                const processedHtml = processHtml(html, url);
                
                // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ iframe
                frame.srcdoc = processedHtml;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStats({
                    size: `${(html.length / 1024).toFixed(1)} KB`,
                    time: `${loadTime}ms`,
                    latency: `${loadTime}ms`,
                    status: '–£—Å–ø–µ—à–Ω–æ'
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º URL
                document.getElementById('currentUrl').textContent = url;
                currentUrl = url;
                
            } catch (error) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                frame.srcdoc = createErrorPage(error.message, url);
                
                updateStats({
                    status: '–û—à–∏–±–∫–∞',
                    error: error.message
                });
                
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 500);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ HTML
        function processHtml(html, baseUrl) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π DOM
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // –î–æ–±–∞–≤–ª—è–µ–º base tag
            const baseTag = doc.createElement('base');
            baseTag.href = baseUrl;
            doc.head.prepend(baseTag);
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏
            doc.querySelectorAll('a[href]').forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.startsWith('#') && !href.startsWith('javascript:')) {
                    const absoluteUrl = new URL(href, baseUrl).href;
                    link.setAttribute('onclick', `parent.navigateTo('${absoluteUrl}'); return false;`);
                    link.setAttribute('href', '#');
                }
            });
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã
            doc.querySelectorAll('form').forEach(form => {
                const action = form.getAttribute('action') || baseUrl;
                const absoluteAction = new URL(action, baseUrl).href;
                
                form.setAttribute('onsubmit', `
                    event.preventDefault();
                    const formData = new FormData(this);
                    parent.submitForm('${absoluteAction}', formData, '${form.method}');
                    return false;
                `);
            });
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π HTML
            return doc.documentElement.outerHTML;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–∫–∏
        function createErrorPage(message, url) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            padding: 40px;
                            background: #f8f9fa;
                            color: #333;
                        }
                        .error-container {
                            max-width: 600px;
                            margin: 0 auto;
                            text-align: center;
                        }
                        .error-icon {
                            font-size: 60px;
                            margin-bottom: 20px;
                            color: #e74c3c;
                        }
                        h1 {
                            color: #c53030;
                            margin-bottom: 20px;
                        }
                        .try-again {
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            margin-top: 20px;
                            font-size: 16px;
                        }
                    </style>
                </head>
                <body>
                    <div class="error-container">
                        <div class="error-icon">‚ùå</div>
                        <h1>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h1>
                        <p style="font-size: 18px; margin-bottom: 10px;">${message}</p>
                        <p style="color: #666; margin-bottom: 20px;">URL: ${url}</p>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; text-align: left; margin: 20px 0;">
                            <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä</li>
                                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL</li>
                                <li>–°–∞–π—Ç –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å CORS –∑–∞–ø—Ä–æ—Å—ã</li>
                                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ</li>
                            </ul>
                        </div>
                        
                        <button class="try-again" onclick="parent.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                        <button class="try-again" onclick="parent.goHome()" style="background: #6c757d; margin-left: 10px;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                    </div>
                </body>
                </html>
            `;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        function getUrlFromParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('url');
        }
        
        function updateStats(stats) {
            if (stats.size) document.getElementById('size').textContent = stats.size;
            if (stats.time) document.getElementById('loadTime').textContent = stats.time;
            if (stats.latency) document.getElementById('latency').textContent = stats.latency;
            if (stats.status) document.getElementById('status').textContent = stats.status;
        }
        
        function addToHistory(url) {
            history.push(url);
            historyIndex = history.length - 1;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
            if (history.length > 50) history.shift();
            localStorage.setItem('proxy_history', JSON.stringify(history));
        }
        
        function handleIframeMessage(event) {
            if (event.data.type === 'NAVIGATE') {
                loadSite(event.data.url);
                addToHistory(event.data.url);
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è iframe
        window.navigateTo = function(url) {
            loadSite(url);
            addToHistory(url);
        };
        
        window.submitForm = function(url, formData, method) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º
            console.log('Form submit to:', url, method, formData);
            alert('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        };
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        window.goBack = function() {
            if (historyIndex > 0) {
                historyIndex--;
                loadSite(history[historyIndex]);
            }
        };
        
        window.goForward = function() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                loadSite(history[historyIndex]);
            }
        };
        
        window.reload = function() {
            loadSite(currentUrl);
        };
        
        window.goHome = function() {
            window.location.href = 'index.html';
        };
        
        window.openSettings = function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = sidebar.style.display === 'block' ? 'none' : 'block';
        };
    </script>
</body>
              </html>
